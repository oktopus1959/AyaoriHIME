###### [FAQ HOME](../FAQ.md#FAQ-HOME)

# FAQ 交ぜ書き変換編

## 目次

- [交ぜ書き変換って何ですか](#交ぜ書き変換って何ですか)
- [変換キーの設定](#変換キーの設定)
    - [配列定義の中で変換キーを設定する](#配列定義の中で変換キーを設定する)
    - [拡張修飾キーで設定する](#拡張修飾キーで設定する)
- [ユーザー辞書登録](#ユーザー辞書登録)
    - [「ばかばかしい,馬鹿馬鹿しい,形容詞」を登録したら展開後行数が224行になりました](#ばかばかしい馬鹿馬鹿しい形容詞を登録したら展開後行数が224行になりました)
    - [交ぜ書き展開とは何ですか](#交ぜ書き展開とは何ですか)
    - [交ぜ書き展開を抑制したい](#交ぜ書き展開を抑制したい)
    - [交ぜ書き展開の抑制をデフォルトにしたい](#交ぜ書き展開の抑制をデフォルトにしたい)

## 交ぜ書き変換って何ですか


## 変換キーの設定
配列の中で変換キーを設定する方法と、拡張修飾キーで設定する方法があります。

### 配列定義の中で変換キーを設定する
従来の漢直WSでは、`@M` が交ぜ書き変換の起動指定文字でした。この記法は漢織媛でも有効です。

たとえば、以下の記述は `:` キーに交ぜ書き変換を割り当てています。
```
-46>@M
```
または、次のように記述することもできます。
```
-46>{MazeConversion}
```

実は、漢織媛的にはこちらのほうが正式な記法であり、`@M` は内部で `{MazeConversion}` に変換されています。

#### 「変換キー」にバインドする例
```
-Henkan>{MazeConversion}
```

### 拡張修飾キーで設定する
以下は、無変換キーを拡張修飾キーとして使用し、「`無変換+K`」を交ぜ書き変換キーとして設定する例です。

![alt text](image/mazegaki-key-assign.png)

まず、無変換キーに対して拡張シフト面を設定します。以下では拡張シフトB面を設定しています。<br>
![alt text](image/extended-mod-shift.png)

修飾キー設定で無変換キーを選択し、`K` の「割り当てキー/機能名」のセルをダブルクリックします。

![alt text](image/mazegaki-mod-conv.png)<br>

機能名選択で、「`MazeConversion`」を選択します。<br>
![alt text](image/mazegaki-maze-conv.png)

`MazeConversion` が設定されていることを確認したら、`書き出し`をクリックします。<br>
![alt text](image/mazegaki-maze-conv-2.png)

元の画面に戻ったら、「`適用`」をクリックします。<br>
![alt text](image/mazegaki-key-assign-reload.png)

その後、「拡張修飾キー」の「有効」にチェックが入っていることを確認してください。

以上。

## ユーザー辞書登録
「履歴・交ぜ書き」タブを開き、「交ぜ書きユーザー辞書」の「開く」をクリックします。<br>
![alt text](image/mazegaki-dic-open.png)

テキストエディターが開いて、`userFiles/userDic.csv` ファイルの内容が表示されます。<br>
![alt text](image/mazegaki-dic-sample.png)

この辞書はサンプルなので、不要なものは削除してください。

1行に1エントリを記述します。フォーマットは次のようになっています。

`[フラグ]読み,変換形,品詞,重み`

このうち、 `品詞`と`重み`は省略できます。
- `品詞` を省略すると `名詞` になる
- `重み` を省略すると 5000 が設定される

`フラグ` には `*`, `+`, `-` の3種があります。
- `*`: エントリを交ぜ書き展開する (デフォルト)
- `+`: エントリを交ぜ書き展開しない。活用形の展開は行う。
- `-`: エントリを交ぜ書き展開も活用形展開もしない

(`フラグ`が `#` の場合は、その行が無視されます。)

`品詞` には以下のものがあります。
|名称|説明|
|-|-|
|名詞|一般名詞|
|サ変|名詞であり、「～する」という形の動詞にもなるもの|
|固有名詞|人名、地名、組織名などの固有名詞一般|
|人名|人名を表す固有名詞|
|姓|姓を表す固有名詞|
|名|名を表す固有名詞|
|地域|地域を表す固有名詞|
|地名|地名を表す固有名詞|
|組織|組織を表す固有名詞|
|数|数詞|
|副詞|副詞|
|形容詞|形容詞|
|形容動詞|形容動詞。「~な」という表現が可能なもの|
|五段|五段活用する動詞|
|四段|四段活用する動詞 (末尾「ふ」(ハ行)もサポート)|
|一段|一段活用する動詞|
|クル|「くる」「こない」「きて」のような活用をする動詞|
|来ル|「来る」「来ない」「来て」のような活用をする動詞|
|スル|「～する」「~しない」「~して」のような活用をする動詞。語幹が名詞にならないもの|
|ズル|「～ずる」「~じない」「~じて」のような活用をする動詞|

辞書の追加や修正が終わってファイルを保存したら、「インポート」をクリックします。<br>
![alt text](image/mazegaki-dic-import.png)

以下のような結果が表示されればOKです。<br>
![alt text](image/mazegaki-dic-import-done.png)

記述に間違いがあると、現状、次のような不親切な表示になります。
いずれエラー箇所を表示するようにする予定ですが、現状はがんばって目視でエラー箇所を探してください。<br>
![alt text](image/mazegaki-dic-import-error.png)

### 「ばかばかしい,馬鹿馬鹿しい,形容詞」を登録したら展開後行数が224行になりました
![alt text](image/maze-expansion.png)

交ぜ書き辞書は、デフォルトで登録しようとするエントリを「交ぜ書き展開」します。これは、「ばかばかしい,馬鹿馬鹿しい」の例だと次のようになります。

```
馬鹿馬鹿しい
馬鹿馬かしい
馬鹿ば鹿しい
馬鹿ばかしい
馬か馬鹿しい
馬か馬かしい
馬かば鹿しい
馬かばかしい
ば鹿馬鹿しい
ば鹿馬かしい
ば鹿ば鹿しい
ば鹿ばかしい
ばか馬鹿しい
ばか馬かしい
ばかば鹿しい
ばかばかしい
```

都合16通りに展開されます。

さらに、形容詞は活用形が14通りあります。

```
馬鹿馬鹿しい
馬鹿馬鹿し
馬鹿馬鹿しから
馬鹿馬鹿しかろ
馬鹿馬鹿しかっ
馬鹿馬鹿しく
馬鹿馬鹿しくっ
馬鹿馬鹿しゅう
馬鹿馬鹿しき
馬鹿馬鹿しけれ
馬鹿馬鹿しかれ
馬鹿馬鹿しけりゃ
馬鹿馬鹿しきゃ
馬鹿馬鹿し(ガル接続)
```

16×14 で都合 224通りというわけです。

### 交ぜ書き展開とは何ですか
ひらがなの読みと、漢字やカタカナを含む変換形が与えられた時に、漢字の読みを推定して有りえる「交ぜ書き」のパターンを出力することです。

上述の「ばかばかしい,馬鹿馬鹿しい」のケースでは、馬→ば、鹿→か、と容易に推定できますが、推定の難しいものもあります。

漢織媛は、漢字に対してその音読みと訓読みのテーブルを持っています。

```
あおうなばら,青海原
```

の場合、青→あお、原→ばらの推定は比較的楽ですが、「海→うな」をどうやって推定するか。「海」には「カイ、うみ、み、わた、わだ」しか読みとして登録されていません。

これは推定方法の一例ですが、この例ではまず、前後の「青」と「原」の推定ができているので、そこから中間の「海」は「うな」だろうと推定しています。このように周りを固めることによって、残りを推定するというようなこともやっています。

なので、上のケースでは、次のように展開されます。

```
青海原,青海原
青海ばら,青海原
青うな原,青海原
青うなばら,青海原
あお海原,青海原
あお海ばら,青海原
あおうな原,青海原
あおうなばら,青海原
```

もう一つ、「さざんか,山茶花」の例。これは末尾の「か,花」しか推定できないので、次のように展開されます。
```
山茶花,山茶花
さざん花,山茶花
山茶か,山茶花
さざんか,山茶花
```

### 交ぜ書き展開を抑制したい
エントリの先頭に `+` または `-` を付けてください。

```
+ばかばかしい,馬鹿馬鹿しい,形容詞
```

こうすると交ぜ書き展開をしなくなります。`+` の場合は活用形展開をやりますが、`-` だとさらに活用形展開も抑制されます。

```
-あやしぃ,怪しぃ,形容詞
```

上記は基本形の「あやしぃ」と「怪しぃ」の2通りだけが登録されるようになります。

### 交ぜ書き展開の抑制をデフォルトにしたい
`#unexpandMaze` という一行を記述します。
この行以降のエントリはデフォルトで交ぜ書き展開が抑制されます。

その中でも「あえて交ぜ書き展開したい」というエントリには、先頭に `*` を付与してください。

また、途中から再び交ぜ書き変換をデフォルトに戻したい、という場合は、 `#expandMaze` という一行を記述します。

```
#unexpandMaze
# 以下は交ぜ書き展開しない
ちさんちしょう,地産地消,サ変
あやおりひめ,漢織媛,固有名詞
かまどねづこ,竈門禰豆子,人名
# 次のエントリは交ぜ書き展開される
*いせかい,異世界

#expandMaze
# 以降、再び交ぜ書き展開を行う
みもだえる,身悶える,一段
```